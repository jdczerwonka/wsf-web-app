{% extends "layout.html" %}

{% block content %}

<h2>{{ title }}.</h2>
<h3>{{ message }}</h3>

<div class="row">
    <div id="myDiv" style="width: 600px; height: 600px;" class="col-xs-12 col-md-8"><!-- Plotly chart will be drawn inside this DIV --></div>
    <form class="form-horizontal col-xs-12 col-md-4 form-wt-opt" id="frmWeightOpt">
        <div class="col-sm-12">
            <h2 class="text-center">Input Fields</h2>
        </div>

        <div class="panel-group col-xs-12" id="accordion" role="tablist" aria-multiselectable="true">
            <div class="panel panel-default">
                <div class="panel-heading" role="tab" id="headingOne">
                    <h4 class="panel-title">
                        <a role="button" data-toggle="collapse" data-parent="#accordion" href="#collapseOne" aria-expanded="true" aria-controls="collapseOne">
                            Sell Attributes
                        </a>
                    </h4>
                </div>
                <div id="collapseOne" class="panel-collapse collapse in" role="tabpanel" aria-labelledby="headingOne">
                    <div class="panel-body">
                        <div class="form-group">
                            <label for="inpBasePrice" class="control-label col-xs-6">Base Price</label>
                            <div class="col-xs-1"></div>
                            <div class="input-group col-xs-4">
                                <div class="input-group-addon">$</div>
                                <input type="text" class="form-control" style="border-top-right-radius: 4px; border-bottom-right-radius: 4px;" id="inpBasePrice" name="base_price" value="80.00" />
                            </div>
                            <div class="col-xs-1"></div>
                        </div>

                        <div class="form-group">
                            <label for="inpCarcassStdDev" class="control-label col-xs-6">Carcass Std Dev</label>
                            <div class="col-xs-1"></div>
                            <div class="input-group col-xs-4">
                                <input type="text" class="form-control" style="border-radius:4px" id="inpCarcassStdDev" name="carcass_std_dev" value="18" />
                            </div>
                            <div class="col-xs-1"></div>
                        </div>

                        <div class="form-group">
                            <label for="inpYieldAvg" class="control-label col-xs-6">Yield Avg</label>
                            <div class="col-xs-1"></div>
                            <div class="input-group col-xs-4">
                                <input type="text" class="form-control" style="border-radius:4px" id="inpYieldAvg" name="yield_avg" value="76.00" />
                            </div>
                            <div class="col-xs-1"></div>
                        </div>

                        <div class="form-group">
                            <label for="inpLeanAvg" class="control-label col-xs-6">Lean Avg</label>
                            <div class="col-xs-1"></div>
                            <div class="input-group col-xs-4">
                                <input type="text" class="form-control" style="border-radius:4px" id="inpLeanAvg" name="lean_avg" value="54.00" />
                            </div>
                            <div class="col-xs-1"></div>
                        </div>

                        <div class="form-group">
                            <label for="inpLeanStdDev" class="control-label col-xs-6">Lean Std Dev</label>
                            <div class="col-xs-1"></div>
                            <div class="input-group col-xs-4">
                                <input type="text" class="form-control" style="border-radius:4px" id="inpLeanStdDev" name="lean_std_dev" value="2.1" />
                            </div>
                            <div class="col-xs-1"></div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="panel panel-default">
                <div class="panel-heading" role="tab" id="headingTwo">
                    <h4 class="panel-title">
                        <a role="button" data-toggle="collapse" data-parent="#accordion" href="#collapseTwo" aria-expanded="true" aria-controls="collapseTwo">
                            Barn Attributes
                        </a>
                    </h4>
                </div>
                <div id="collapseTwo" class="panel-collapse collapse in" role="tabpanel" aria-labelledby="headingTwo">
                    <div class="panel-body">
                        <div class="form-group">
                            <label for="inpRent" class="control-label col-xs-6">Rent</label>
                            <div class="col-xs-1"></div>
                            <div class="input-group col-xs-4">
                                <div class="input-group-addon">$</div>
                                <input type="text" class="form-control" style="border-top-right-radius: 4px; border-bottom-right-radius: 4px;" id="inpRent" name="rent" value="1940" />
                            </div>
                            <div class="col-xs-1"></div>
                        </div>
                        
                        <div class="form-group">
                            <label for="inpWeeks" class="control-label col-xs-6">Avg Weeks in Barn</label>
                            <div class="col-xs-1"></div>
                            <div class="input-group col-xs-4">
                                <input type="text" class="form-control" style="border-radius:4px" id="inpWeeks" name="weeks" value="24.5" />
                            </div>
                            <div class="col-xs-1"></div>
                        </div>

                        <div class="form-group">
                            <label for="inpStartNum" class="control-label col-xs-6">Start Number</label>
                            <div class="col-xs-1"></div>
                            <div class="input-group col-xs-4">
                                <input type="text" class="form-control" style="border-radius:4px" id="inpStartNum" name="start_num" value="2500" />
                            </div>
                            <div class="col-xs-1"></div>
                        </div>

                        <div class="form-group">
                            <label for="inpDeathPer" class="control-label col-xs-6">Death Percentage</label>
                            <div class="col-xs-1"></div>
                            <div class="input-group col-xs-4">
                                <input type="text" class="form-control" id="inpDeathPer" name="death_per" value="4.00" />
                                <div class="input-group-addon">%</div>
                            </div>
                            <div class="col-xs-1"></div>
                        </div>

                        <div class="form-group">
                            <label for="inpDiscountPer" class="control-label col-xs-6">Discount Percentage</label>
                            <div class="col-xs-1"></div>
                            <div class="input-group col-xs-4">
                                <input type="text" class="form-control" id="inpDiscountPer" name="discount_per" value="1.00" />
                                <div class="input-group-addon">%</div>
                            </div>
                            <div class="col-xs-1"></div>
                        </div>
                                    
                    </div>
                </div>
            </div>
        </div>
        
        <div class="form-group">
            <div class="col-xs-7"></div>
            <button type="button" class="btn btn-primary col-xs-4" id="recalculate"><strong>Recalculate</strong></button>
            <div class="col-xs-1"></div>
        </div>
</form>
</div>
<script>
    $(".collapse").collapse();
    $(document).ready(function () {
        $("#frmWeightOpt").formValidation({
            framework: "bootstrap",
            fields: {
                base_price: {
                    validators: {
                        notEmpty: {
                            message: "Base Price is required"
                        },
                        numeric: {
                            message: "Base Price must be a number",
                            decimalSeparator: "."
                        },
                        between: {
                            min: 0,
                            max: 200,
                            message: "Base Price must be between %s and %s"
                        }
                    }
                },
                carcass_std_dev: {
                    validators: {
                        notEmpty: {
                            message: "Carcass Std Dev is required"
                        },
                        numeric: {
                            message: "Carcass Std Dev must be a number",
                            decimalSeparator: "."
                        },
                        between: {
                            min: 0,
                            max: 30,
                            message: "Carcass Std Dev must be between %s and %s"
                        }
                    }
                },
                yield_avg: {
                    validators: {
                        notEmpty: {
                            message: "Yield Avg is required"
                        },
                        numeric: {
                            message: "Yield Avg must be a number",
                            decimalSeparator: "."
                        },
                        between: {
                            min: 60,
                            max: 90,
                            message: "Yield Avg must be between %s and %s"
                        }
                    }
                },
                lean_avg: {
                    validators: {
                        notEmpty: {
                            message: "Lean Avg is required"
                        },
                        numeric: {
                            message: "Lean Avg must be a number",
                            decimalSeparator: "."
                        },
                        between: {
                            min: 25,
                            max: 85,
                            message: "Lean Avg must be between %s and %s"
                        }
                    }
                },
                lean_std_dev: {
                    validators: {
                        notEmpty: {
                            message: "Lean Std Dev is required"
                        },
                        numeric: {
                            message: "Lean Std Dev must be a number",
                            decimalSeparator: "."
                        },
                        between: {
                            min: 0,
                            max: 4,
                            message: "Lean Std Dev must be between %s and %s"
                        }
                    }
                },
                rent: {
                    validators: {
                        notEmpty: {
                                message: "Rent is required"
                        },
                        numeric: {
                            message: "Rent must be a number",
                            decimalSeparator: "."
                        },
                        between: {
                            min: 0,
                            max: 50000,
                            message: "Rent must be between %s and %s"
                        }
                    }
                },
                weeks: {
                    validators: {
                        notEmpty: {
                            message: "Weeks in Barn is required"
                        },
                        numeric: {
                            message: "Weeks in Barn must be a number",
                            decimalSeparator: "."
                        },
                        between: {
                            min: 0,
                            max: 40,
                            message: "Weeks in Barn must be between %s and %s"
                        }
                    }
                },
                start_num: {
                    validators: {
                            notEmpty: {
                                message: "Barn Size is required"
                            },
                        numeric: {
                            message: "Barn Size must be a number"
                        },
                        between: {
                            min: 0,
                            max: 10000,
                            message: "Barn Size must be between %s and %s"
                        }
                    }
                },
                death_per: {
                    validators: {
                        notEmpty: {
                            message: "Death Percentage is required"
                        },
                        numeric: {
                            message: "Death Percentage must be a number",
                            decimalSeparator: "."
                        },
                        between: {
                            min: 0,
                            max: 100,
                            message: "Death Percentage must be between %s and %s"
                        }
                    }
                },
                discount_per: {
                    validators: {
                        notEmpty: {
                            message: "Discount Percentage is required"
                        },
                        numeric: {
                            message: "Discount Percentage must be a number",
                            decimalSeparator: "."
                        },
                        between: {
                            min: 0,
                            max: 100,
                            message: "Discount Percentage must be between %s and %s"
                        }
                    }
                }
            }
        });
    });

    $("input").blur(function () {
        $(this).parent().parent().removeClass("has-success")
    });

    $("#recalculate").click(function () {
        generatePlot();
    });

    function generatePlot() {
        var url = "http://wsf-web-app.azurewebsites.net/api/v1/weightOptApi";
        url = url + "?" + $("#frmWeightOpt").serialize();
        
        $.getJSON(url).done(function (data) {
            var trace1 = {
                x: data.xval,
                y: data.yval,
                type: 'scatter'
            };
            var plot = [trace1];
            var layout = {
                title: 'Optimal Live Weight Curve',
                xaxis: {
                    title: 'Avg Group Live Wt (lbs)',
                    t0: data.xval[0],
                    dtick: 5
                },
                yaxis: {
                    title: 'Revenue Less Deaths, Feed, & Rent ($)'
                }
            };
            Plotly.newPlot('myDiv', plot, layout);
        });
    }
    generatePlot();
</script>

{% endblock %}
